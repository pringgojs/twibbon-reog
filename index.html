<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <title>REOG ROAD TO ICH UNESCO</title>

    <style>
      #wp-twibbon {
        position: relative;
      }
      #frame {
        /* padding: 50px; */
        position: relative;
      }
      #gambarKalian {
        position: absolute;
        cursor: move;
      }
      #gambarTwibbon {
        z-index: 99;
        position: absolute;
        margin-top: -300px;
        cursor: move;
      }
      #img-preview {
        border: 1px solid red;
        width: 300px;
        height: 300px;
        overflow: hidden;
        position: relative;
        /* background-image: url("bg.png"); */
      }

      #canvas {
        position: relative;
      }

      #zoom {
        height: auto;
        width: auto;
        /* display: grid; */
        /* place-items: center; */
        /* position: fixed; */
        /* top: 0; */
        /* left: 0; */
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center">
          <h1>REOG ROAD TO ICH UNESCO</h1>
        </div>
        <div class="col-md-3"></div>
        <div class="col-md-3">
          <div class="card" style="width: 18rem">
            <div class="card-body">
              <h5 class="card-title">Form</h5>

              <div class="mb-3">
                <label for="name" class="form-label">Your name</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  placeholder="Example: Jhon Doe"
                />
              </div>
              <div class="mb-3">
                <label for="name" class="form-label">Your country</label>
                <input
                  type="text"
                  class="form-control"
                  id="country"
                  placeholder="Example: Indonesia"
                />
              </div>
              <div class="mb-3">
                <label for="choose-file" class="form-label">File photo</label>
                <input class="form-control" type="file" id="choose-file" />
              </div>
              <p class="card-text"></p>
              <a href="#" onclick="twibbon()" class="btn btn-primary"
                >Create Twibbon</a
              >
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div
            class="card"
            style="margin-left: 10px; height: auto; position: absolute"
          >
            <div class="card-body">
              <h5 class="card-title">Twibbon Reog</h5>

              <div id="wp-twibbon">
                <div id="frame">
                  <!-- Ganti gambartwibbon.jpg dengan gambar bingkai Twibbon kalian -->
                  <div id="img-preview">
                    <div id="zoom"></div>
                  </div>
                  <img
                    src="bg.png"
                    id="gambarTwibbon"
                    width="300"
                    height="300"
                  />
                </div>

                <!-- 2 Gambar akan digabungkan pada area canvas -->
                <canvas id="canvas"></canvas>
                <div id="download-wp" style="display: none">
                  <button
                    onclick="downloadCanvas()"
                    class="btn btn-sm btn-info mt-2 text-light"
                  >
                    Download
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <nav class="navbar fixed-bottom navbar-dark bg-primary">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">
            <div class="text-center">
              DINAS KOMUNIKASI INFORMATIKA DAN STATISTIK KAB. PONOROGO
            </div></a
          >
        </div>
      </nav>
    </footer>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->

    <script type="text/javascript">
      const chooseFile = document.getElementById("choose-file");
      chooseFile.addEventListener("change", function () {
        getImgData();
      });

      //   zoom
      const zoomElement = document.getElementById("zoom");
      let zoom = 1;
      const ZOOM_SPEED = 0.1;
      const frame = document.getElementById("frame");

      frame.addEventListener("wheel", function (e) {
        if (e.deltaY > 0) {
          zoomElement.style.transform = `scale(${(zoom += ZOOM_SPEED)})`;
        } else {
          zoomElement.style.transform = `scale(${(zoom -= ZOOM_SPEED)})`;
        }
      });

      function getImgData() {
        const files = chooseFile.files[0];
        const imgPreview = document.getElementById("zoom");
        if (files) {
          const fileReader = new FileReader();
          fileReader.readAsDataURL(files);
          fileReader.addEventListener("load", function () {
            imgPreview.style.display = "hidden";
            imgPreview.innerHTML =
              '<img id="gambarKalian" width="300" height="300" src="' +
              this.result +
              '" />';

            dragElement(document.getElementById("gambarKalian"));
          });
        }
      }

      function getPositionXY(x) {
        const element = document.getElementById("gambarKalian");
        var rect = element.getBoundingClientRect();
        if (x == "x") {
          return rect.x;
        }

        return rect.y;
      }

      function twibbon() {
        const name = document.getElementById("name");
        const country = document.getElementById("country");

        // return;

        const gambarKalian = document.getElementById("gambarKalian");
        console.log(gambarKalian);
        const gambarTwibbon = document.getElementById("gambarTwibbon");
        gambarTwibbon.setAttribute("hidden", "true");
        const canvas = document.getElementById("canvas");
        const context = canvas.getContext("2d");
        const width = gambarTwibbon.width;
        const height = gambarTwibbon.height;
        canvas.width = width;
        canvas.height = height;

        context.drawImage(gambarKalian, 0, 0, width, height);
        context.getImageData(0, 0, width, height);
        context.drawImage(gambarTwibbon, 0, 0, width, height);
        context.getImageData(0, 0, width, height);

        context.font = "14px Arial";
        // context.lineWidth = 3;
        var gradient = context.createLinearGradient(0, 200, 0, 300);
        gradient.addColorStop(0, "Yellow");
        gradient.addColorStop(1, "Red");
        context.fillStyle = gradient;
        context.strokeStyle = "#FFFFFF";
        context.strokeText(name.value.toUpperCase(), 10, 80);
        context.font = "46px Arial";
        // context.fillText(country.value.toUpperCase(), 10, 120);
        context.strokeText(country.value.toUpperCase(), 10, 120);
        $("#frame").hide(0);
        $("#download-wp").show();
      }

      function downloadCanvas() {
        const canvas = document.getElementById("canvas");
        var image = canvas.toDataURL();

        // create temporary link
        var tmpLink = document.createElement("a");
        tmpLink.download = "image.png"; // set the name of the download file
        tmpLink.href = image;

        // temporarily add link to body and initiate the download
        document.body.appendChild(tmpLink);
        tmpLink.click();
        document.body.removeChild(tmpLink);
      }

      //   drag

      function dragElement(elmnt) {
        var pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;

        // console.log(elmnt);
        if (document.getElementById("gambarTwibbon")) {
          /* if present, the header is where you move the DIV from:*/
          document.getElementById("gambarTwibbon").onmousedown = dragMouseDown;
        } else {
          /* otherwise, move the DIV from anywhere inside the DIV:*/
          elmnt.onmousedown = dragMouseDown;
        }

        elmnt.onmousedown = dragMouseDown;

        function dragMouseDown(e) {
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          // call a function whenever the cursor moves:
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          // set the element's new position:
          elmnt.style.top = elmnt.offsetTop - pos2 + "px";
          elmnt.style.left = elmnt.offsetLeft - pos1 + "px";

          console.log("x" + getPositionXY("x"));
          console.log("y" + getPositionXY("y"));
        }

        function closeDragElement() {
          /* stop moving when mouse button is released:*/
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }
    </script>
  </body>
</html>
