<!DOCTYPE html>
<html>
  <head>
    <title>
      Menggabungkan 2 Gambar Seperti Twibbon Menggunakan HTML dan JavaScript
    </title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>

    <style>
      #frame {
        padding: 50px;
      }
      #gambarKalian {
        position: absolute;
        cursor: move;
      }
      #gambarTwibbon {
        z-index: 99;
        position: fixed;
        margin-top: -300px;
        cursor: move;
      }
      #img-preview {
        border: 1px solid red;
        width: 300px;
        height: 300px;
        overflow: hidden;
        position: relative;
        /* background-image: url("bg.png"); */
      }
    </style>
  </head>
  <body>
    <input type="text" name="name" placeholder="Masukkan nama anda" id="name" />
    <input
      type="text"
      name="country"
      placeholder="Masukkan negara anda"
      id="country"
    />
    <input type="file" accept="image/*" id="choose-file" name="choose-file" />
    <br />
    <button type="button" onclick="twibbon()">Create twibbon</button>
    <!-- Ganti gambarkalian.jpg dengan gambar yang akan kalian pakai -->

    <div id="frame">
      <!-- Ganti gambartwibbon.jpg dengan gambar bingkai Twibbon kalian -->
      <div id="img-preview"></div>
      <img src="bg.png" id="gambarTwibbon" width="300" height="300" />
      <br /><br />

      <!-- <img
        src="profile.jpg"
        id="gambarKalian"
        width="300"
        height="300"
        hidden="true"
      /> -->
    </div>

    <!-- 2 Gambar akan digabungkan pada area canvas -->
    <canvas id="canvas"></canvas>

    <!-- JavaScript buat menggabungkan 2 gambar -->
    <script type="text/javascript">
      const chooseFile = document.getElementById("choose-file");
      chooseFile.addEventListener("change", function () {
        getImgData();
      });

      function getImgData() {
        const files = chooseFile.files[0];
        const imgPreview = document.getElementById("img-preview");
        if (files) {
          const fileReader = new FileReader();
          fileReader.readAsDataURL(files);
          fileReader.addEventListener("load", function () {
            imgPreview.style.display = "hidden";
            imgPreview.innerHTML =
              '<img id="gambarKalian" width="300" height="300" src="' +
              this.result +
              '" />';

            dragElement(document.getElementById("gambarKalian"));
          });
        }
      }

      function getPositionXY(x) {
        const element = document.getElementById("gambarKalian");
        var rect = element.getBoundingClientRect();
        if (x == "x") {
          return rect.x;
        }

        return rect.y;
      }

      function twibbon() {
        const name = document.getElementById("name");
        const country = document.getElementById("country");

        // return;

        const gambarKalian = document.getElementById("gambarKalian");
        console.log(gambarKalian);
        const gambarTwibbon = document.getElementById("gambarTwibbon");
        gambarTwibbon.setAttribute("hidden", "true");
        const canvas = document.getElementById("canvas");
        const context = canvas.getContext("2d");
        const width = gambarTwibbon.width;
        const height = gambarTwibbon.height;
        canvas.width = width;
        canvas.height = height;

        context.drawImage(
          gambarKalian,
          getPositionXY("x"),
          getPositionXY("y") - 88,
          width,
          height
        );
        context.font = "20pt Calibri";
        context.fillStyle = "Red";
        context.fillText(name.value, 150, 270);
        context.getImageData(0, 0, width, height);

        context.drawImage(gambarTwibbon, 0, 0, width, height);
        context.font = "14pt Calibri";
        context.fillStyle = "Red";
        context.fillText(country.value, 150, 300);
        context.getImageData(0, 0, width, height);
      }

      //   drag

      function dragElement(elmnt) {
        var pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;

        // console.log(elmnt);
        if (document.getElementById("gambarTwibbon")) {
          /* if present, the header is where you move the DIV from:*/
          document.getElementById("gambarTwibbon").onmousedown = dragMouseDown;
        } else {
          /* otherwise, move the DIV from anywhere inside the DIV:*/
          elmnt.onmousedown = dragMouseDown;
        }

        elmnt.onmousedown = dragMouseDown;

        function dragMouseDown(e) {
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          // call a function whenever the cursor moves:
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          // set the element's new position:
          elmnt.style.top = elmnt.offsetTop - pos2 + "px";
          elmnt.style.left = elmnt.offsetLeft - pos1 + "px";

          console.log("x" + getPositionXY("x"));
          console.log("y" + getPositionXY("y"));
        }

        function closeDragElement() {
          /* stop moving when mouse button is released:*/
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }
    </script>
  </body>
</html>
